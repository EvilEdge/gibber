function sign(t){return 0>t?-1:1}var Interface={extend:function(t,i){for(var e in i){{e.split(".")}t[e]=i[e]instanceof Array&&i[e].length<100?i[e].slice(0):i[e]}return t},isAndroid:function(){var t=navigator.userAgent.toLowerCase();return t.indexOf("android")>-1}(),panels:[],mouseDown:!1,useTouch:"ontouchstart"in document.documentElement};Interface.Presets={dictionary:"undefined"==typeof localStorage.interfacejs?{}:JSON.parse(localStorage.interfacejs),save:function(t){for(var i=[],e=0;e<Interface.panels.length;e++){var s=Interface.panels[e];i[e]=[];for(var h=0;h<s.children.length;h++){var n=s.children[h];if("object"==typeof n.children){for(var a=[],o=0;o<n.children.length;o++)a[o]=n.children[o].value;i[e][h]=a}else i[e][h]=n.value}this.dictionary[t]=i,localStorage.interfacejs=JSON.stringify(this.dictionary)}},load:function(t){for(var i=this.dictionary[t],e=0;e<Interface.panels.length;e++)for(var s=Interface.panels[e],h=0;h<s.children.length;h++){var n=s.children[h];if("object"==typeof n.children)for(var a=0;a<n.children.length;a++)n.children[a].setValue(i[e][h][a]);else n.setValue(i[e][h])}},list:function(){return Object.keys(this.dictionary)}},Interface.Panel=function(){var t=this,i=arguments.length>=1?arguments[0].container:void 0;Interface.extend(this,{type:"Panel",active:!0,children:[],shouldDraw:[],fps:30,useRelativeSizesAndPositions:!0,labelSize:"12px",font:"normal 12px Helvetica",serializeMe:["fps","useRelativeSizesAndPositions","labelSize","font","background","fill","stroke","backgroundColor"],container:function(){if("undefined"==typeof i){$("body").css({margin:0,padding:0});var t=$('<div id="container">');return t.css({width:$(window).width(),height:$(window).height(),display:"block",margin:0,padding:0,position:"absolute",left:0,top:0}),$("body").append(t),t}return i}(),canvas:document.createElement("canvas"),touchEvent:function(i){if(t.active){for(var e=0;e<i.changedTouches.length;e++)for(var s=i.changedTouches.item(e),h=0;h<t.children.length;h++)s.x=s.pageX-t.x,s.y=s.pageY-t.y,s.type=i.type,t.children[h].touchEvent(s);i.preventDefault()}},mouseEvent:function(i){if(t.active){"mousedown"===i.type?Interface.mouseDown=!0:"mouseup"===i.type&&(Interface.mouseDown=!1);for(var e={x:i.offsetX||i.pageX-t.x,y:i.offsetY||i.pageY-t.y,type:i.type},s=0;s<t.children.length;s++)t.children[s].mouseEvent(e)}},init:function(){var t=$(this.container).offset();this.width=$(this.container).width(),this.height=$(this.container).height(),this.x=t.left,this.y=t.top,isNaN(this.x)&&(this.x=0),isNaN(this.y)&&(this.y=0),$(this.canvas).attr({width:this.width,height:this.height}),$(this.container).css({"user-select":"none","-webkit-user-select":"none"}),$(this.container).append(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx.translate(.5,.5),this.ctx.lineWidth=1,Interface.useTouch?($(this.container).on("touchstart",this.touchEvent),$(this.container).on("touchmove",this.touchEvent),$(this.container).on("touchend",this.touchEvent)):($(this.container).on("mousedown",this.mouseEvent),$(this.container).on("mousemove",this.mouseEvent),$(this.container).on("mouseup",this.mouseEvent))},draw:function(){if(this.active){for(var t=0;t<this.shouldDraw.length;t++)this.shouldDraw[t].draw();this.shouldDraw.length=0}},getWidgetWithName:function(t){for(var i=0;i<this.children.length;i++)if(this.children[i].name===t)return this.children[i]},redoBoundaries:function(){var t=$(this.container).offset();this.width=$(this.container).width(),this.height=$(this.container).height(),this.x=t.left,this.y=t.top,isNaN(this.x)&&(this.x=0),isNaN(this.y)&&(this.y=0),$(this.canvas).attr({width:this.width,height:this.height}),this.ctx.translate(.5,.5),this.ctx.lineWidth=1,this.refresh()},refresh:function(){if(this.active){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=0;t<this.children.length;t++)this.children[t].draw()}},add:function(){for(var t=0;t<arguments.length;t++){var i=arguments[t];i.panel=this,i.canvas=this.canvas,i.container=this.container,i.ctx=this.ctx,this.children.push(i),i._init&&!i.added&&i._init(),i.oninit&&!i.added&&i.oninit(),i.draw(),i.added=!0,"function"==typeof i.add&&i.add()}},clear:function(){this.ctx.clearRect(0,0,this.width,this.height),this.children.length=0},remove:function(t){if(this.ctx.clearRect(t._x(),t._y(),t._width(),t._height()),"undefined"!=typeof t.children&&"XY"!==t.type)for(var i=0;i<t.children.length;i++)this.children.splice(this.children.indexOf(t.children[i]));else this.children.indexOf(t)>-1&&(this.children.splice(this.children.indexOf(t)),"function"==typeof t.remove&&t.remove())}}),"undefined"!=typeof arguments[0]&&Interface.extend(this,arguments[0]),this.backgroundColor&&this.setBackgroundColor(this.backgroundColor),this.init(),this.timer=setInterval(function(){t.draw()},Math.round(1e3/this.fps));var e="#000",s="#666",h="#999",n="transparent",t=this,a=this.useRelativeSizesAndPositions;Object.defineProperties(this,{useRelativeSizesAndPositions:{get:function(){return a},set:function(t){if(t!==a)if(a=t,t===!1)for(var i=0;i<this.children.length;i++){var e=this.children[i];e.bounds=[Math.round(e.x*this.width),Math.round(e.y*this.height),Math.round(e.width*this.width),Math.round(e.height*this.height)]}else for(var i=0;i<this.children.length;i++){var e=this.children[i];e.bounds=[e.x/this.width,e.y/this.height,e.width/this.width,e.height/this.height]}this.refresh()}},background:{get:function(){return n},set:function(t){n=t,$(this.container).css({backgroundColor:n})}},childBackground:{get:function(){return e},set:function(i){e=i,t.refresh()}},childStroke:{get:function(){return h},set:function(i){h=i,t.refresh()}},childFill:{get:function(){return s},set:function(i){s=i,t.refresh()}}}),arguments[0]&&(arguments[0].childBackground&&(this.childBackground=arguments[0].childBackground),arguments[0].childFill&&(this.childFill=arguments[0].childFill),arguments[0].childStroke&&(this.childStroke=arguments[0].childStroke)),Interface.panels.push(this)};var convertMouseEvent=function(t){switch(t){case"mousedown":return"touchmousedown";case"mousemove":return"touchmousemove";case"mouseup":return"touchmouseup";default:return t}},convertTouchEvent=function(t){switch(t){case"touchstart":return"touchmousedown";case"touchmove":return"touchmousemove";case"touchend":return"touchmouseup";default:return t}},__widgetCount=0,widgetDefaults={hasFocus:!1,requiresFocus:!0,min:0,max:1,value:0,lastValue:null,name:null,events:{ontouchstart:null,ontouchmove:null,ontouchend:null,onmousedown:null,onmousemove:null,onmouseup:null,ontouchmousedown:null,ontouchmousemove:null,ontouchmouseup:null,onvaluechange:null}};Interface.Widget={init:function(t){this.added=!1,Interface.extend(this,widgetDefaults),this.name=t.name||this.type+"_"+__widgetCount++,this.target="OSC",this.key="/"+this.name,Interface.extend(this,t),this.bounds&&(this.x=t.bounds[0],this.y=t.bounds[1],this.width=t.bounds[2],this.height=t.bounds[3]),this.colors&&(this.background=t.colors[0],this.fill=t.colors[1],this.stroke=t.colors[2]),this.focusedTouches=[],this.value&&this.setValue(this.value,!0);{var i=this.bounds||[this.x,this.y,this.width,this.height],e=this.x,s=this.y,h=this.width,n=this.height;this.value}Object.defineProperties(this,{bounds:{configurable:!0,get:function(){return i},set:function(t){i=t,this.x=i[0],this.y=i[1],this.width=i[2],this.height=i[3]}},x:{configurable:!0,get:function(){return e},set:function(t){this.clear(),e=t,this.refresh()}},y:{configurable:!0,get:function(){return s},set:function(t){this.clear(),s=t,this.refresh()}},width:{configurable:!0,get:function(){return h},set:function(t){this.clear(),h=t,this.refresh()}},height:{configurable:!0,get:function(){return n},set:function(t){this.clear(),n=t,this.refresh()}}})},clear:function(){this.panel.ctx.clearRect(this._x(),this._y(),this._width(),this._height())},refresh:function(){-1===this.panel.shouldDraw.indexOf(this)&&this.panel.shouldDraw.push(this)},setValue:function(t,i){var e=this.max-this.min,s=t;this.value=t,0!==this.min||1!==this.max?(s-=this.min,this._value=s/e):this._value=this.value,i||this.refresh()},hitTest:function(t){return t.x>=this._x()&&t.x<=this._x()+this._width()&&t.y>=this._y()&&t.y<=this._y()+this._height()?!0:!1},mouseEvent:function(t){var i=this.hitTest(t),e=convertMouseEvent(t.type);(i||this.hasFocus||!this.requiresFocus)&&("mousedown"===t.type&&(this.hasFocus=!0),this[t.type]&&this[t.type](t,i),this["on"+t.type]&&this["on"+t.type](t,i),this["on"+e]&&this["on"+e](t,i)),"mouseup"===t.type&&(this.hasFocus=!1)},touchEvent:function(t){var i=this.hitTest(t),e=convertTouchEvent(t.type);if((i||this.hasFocus||!this.requiresFocus)&&("touchstart"===t.type&&(this.focusedTouches.push(t),this.hasFocus=!0),this[t.type]&&this[t.type](t,i),this["on"+t.type]&&this["on"+t.type](t,i),this["on"+e]&&this["on"+e](t,i)),"touchend"===t.type)for(var s=0;s<this.focusedTouches.length;s++)if(this.focusedTouches[s].id===t.id){this.focusedTouches.splice(s,1),0===this.focusedTouches.length&&(this.hasFocus=!1);break}},draw:function(){},sendTargetMessage:function(){if(this.target&&this.key)if("OSC"===this.target){if(Interface.OSC)if("undefined"==typeof this.values){var t="string"==typeof this.value?"s":"f";Interface.OSC.send(this.key,t,[this.value])}else if("undefined"==typeof this.sendValues){for(var t="",i=0;i<this.values.length;i++)t+="string"==typeof this.value?"s":"f";Interface.OSC.send(this.key,t,this.values)}else this.sendValues()}else"MIDI"===this.target?Interface.MIDI&&"undefined"==typeof this.values&&Interface.MIDI.send(this.key[0],this.key[1],this.key[2],this.value):"function"==typeof this.target[this.key]?this.target[this.key](this.values||this.value):this.target[this.key]=this.values||this.value},_background:function(){return this.background||this.panel.childBackground},_stroke:function(){return this.stroke||this.panel.childStroke},_fill:function(){return this.fill||this.panel.childFill},_x:function(){return this.panel.useRelativeSizesAndPositions?Math.floor(this.x*this.panel.width):this.x},_y:function(){return this.panel.useRelativeSizesAndPositions?Math.floor(this.y*this.panel.height):this.y},_width:function(){return this.panel.useRelativeSizesAndPositions?Math.floor(this.width*this.panel.width):this.width},_height:function(){return this.panel.useRelativeSizesAndPositions?Math.floor(this.height*this.panel.height):this.height},_font:function(){var t=this.font||this.panel.font;return t},label:null,_serializeMe:["background","stroke","fill","x","y","width","height","value","label","onmousedown","onmousemove","onmouseup","ontouchmousedown","ontouchmousemove","ontouchmouseup","ontouchstart","ontouchmove","ontouchend","onvaluechange","name","type","target","key"]},Interface.Slider=function(){Interface.extend(this,{type:"Slider",isVertical:!0,serializeMe:["isVertical"],draw:function(){var t=this._x(),i=this._y(),e=this._width(),s=this._height();this.ctx.fillStyle=this._background(),this.ctx.fillRect(t,i,e,s),this.ctx.fillStyle=this._fill(),this.isVertical?this.ctx.fillRect(t,i+s-this._value*s,e,this._value*s):this.ctx.fillRect(t,i,e*this._value,s),this.label&&(this.ctx.fillStyle=this._stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=this._font(),this.ctx.fillText(this.label,t+e/2,i+s/2)),this.ctx.strokeStyle=this._stroke(),this.ctx.strokeRect(t,i,e,s)},changeValue:function(t,i){(this.hasFocus||!this.requiresFocus)&&(this._value=this.isVertical?1-i/this._height():t/this._width(),this._value<0?this._value=0:this._value>1&&(this._value=1),this.value=this.min+(this.max-this.min)*this._value,this.value!==this.lastValue&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.refresh(),this.lastValue=this.value))},mousedown:function(t,i){i&&Interface.mouseDown&&this.changeValue(t.x-this._x(),t.y-this._y())},mousemove:function(t,i){i&&Interface.mouseDown&&this.changeValue(t.x-this._x(),t.y-this._y())},mouseup:function(t,i){i&&Interface.mouseDown&&this.changeValue(t.x-this._x(),t.y-this._y())},touchstart:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())},touchmove:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())},touchend:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())}}).init(arguments[0])},Interface.Slider.prototype=Interface.Widget,Interface.Crossfader=function(){Interface.extend(this,{type:"Crossfader",crossfaderWidth:30,serializeMe:["crossfaderWidth"],_value:.5,draw:function(){var t=this._x(),i=this._y(),e=this._width(),s=this._height();this.ctx.fillStyle=this._background(),this.ctx.fillRect(t,i,e,s),this.ctx.fillStyle=this._fill(),this.ctx.fillRect(t+(e-this.crossfaderWidth)*this._value,i,this.crossfaderWidth,s),this.ctx.strokeStyle=this._stroke(),this.ctx.strokeRect(t,i,e,s)},changeValue:function(t){(this.hasFocus||!this.requiresFocus)&&(this._value=t/this._width(),this._value<0?this._value=0:this._value>1&&(this._value=1),this.value=this.min+(this.max-this.min)*this._value,this.value!==this.lastValue&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.refresh(),this.lastValue=this.value))},mousedown:function(t){this.changeValue(t.x-this._x(),t.y-this._y())},mousemove:function(t){this.changeValue(t.x-this._x(),t.y-this._y())},mouseup:function(t){this.changeValue(t.x-this._x(),t.y-this._y())},touchstart:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())},touchmove:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())},touchend:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())}}).init(arguments[0])},Interface.Crossfader.prototype=Interface.Widget,Interface.Button=function(){Interface.extend(this,{type:"Button",_value:0,serializeMe:["mode","label"],mode:"toggle",isMouseOver:!1,isTouchOver:!1,label:null,draw:function(){var t=this._x(),i=this._y(),e=this._width(),s=this._height();this.ctx.fillStyle=this._value?this._fill():this._background(),this.ctx.fillRect(t,i,e,s),null!==this.label&&(this.ctx.fillStyle=this._stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=this._font(),this.ctx.fillText(this.label,t+e/2,i+s/2)),this.ctx.strokeStyle=this._stroke(),this.ctx.strokeRect(t,i,e,s)},changeValue:function(){(this.hasFocus||!this.requiresFocus)&&(this._value=!this._value,this.value=this._value?this.max:this.min,(this.value!==this.lastValue||"contact"===this.mode)&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.draw(),this.lastValue=this.value))},setValue:function(t,i){var e=this.max-this.min,s=t;this.value=t,0!==this.min||1!==this.max?(s-=this.min,this._value=s/e):this._value=this.value,this.lastValue=this.value,i||"contact"===this.mode||this.refresh()},mousedown:function(t,i){if(i&&Interface.mouseDown&&(this.isMouseOver=!0,this.changeValue(),"contact"===this.mode)){var e=this;setTimeout(function(){e._value=0,e.draw()},75)}},mousemove:function(t,i){if(!this.requiresFocus&&i&&Interface.mouseDown&&!this.isMouseOver)if(this.isMouseOver=!0,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var e=this;setTimeout(function(){e._value=0,e.draw()},75)}else!i&&this.isMouseOver&&(this.isMouseOver=!1)},mouseup:function(){"momentary"===this.mode&&this.changeValue()},touchstart:function(t,i){if(i&&(this.isTouchOver=!0,this.changeValue(),"contact"===this.mode)){var e=this;setTimeout(function(){e._value=0,e.draw()},75)}},touchmove:function(t,i){if(this.requiresFocus||!i||this.isTouchOver)!i&&this.isTouchOver&&(this.isTouchOver=!1);else if(this.isTouchOver=!0,"contact"!==this.mode)this.changeValue();else{this._value=1,this.draw();var e=this;setTimeout(function(){e._value=0,e.draw()},75)}},touchend:function(){this.isTouchOver=!1,"momentary"===this.mode&&this.changeValue()}}).init(arguments[0])},Interface.Button.prototype=Interface.Widget,Interface.Knob=function(){Interface.extend(this,{type:"Knob",_value:0,serializeMe:["usesRotation","knobBuffer"],knobBuffer:3,lastPosition:0,usesRotation:!0,draw:function(){var t=this._x(),i=this._y(),e=this._width(),s=(this._height(),e/2);this.ctx.clearRect(t,i,2*s,2*s),this.ctx.strokeStyle=this._stroke(),this.ctx.fillStyle=this._background();var h=.6*Math.PI,n=.4*Math.PI;if(this.ctx.beginPath(),this.ctx.arc(t+s,i+s,s-this.knobBuffer,h,n,!1),this.ctx.arc(t+s,i+s,.3*(s-this.knobBuffer),n,h,!0),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=this._fill(),this.centerZero){var a,o=1.5*Math.PI;a=this._value>=.5?Math.PI*(1.5+1.8*(this._value-.5)):Math.PI*(1.5-.9*(1-2*this._value)),this._value>1.8*Math.PI&&(this._value-=1.8*Math.PI),this.ctx.beginPath(),this.ctx.arc(t+s,i+s,s-this.knobBuffer,o,a,this._value<.5),this.ctx.arc(t+s,i+s,.3*(s-this.knobBuffer),a,o,this._value>.5),this.ctx.closePath(),this.ctx.fill()}else{if(this.isInverted)var c=Math.PI*(.4-1.8*this._value);else{var c=.6*Math.PI+1.8*this._value*Math.PI;c>2*Math.PI&&(c-=2*Math.PI)}this.ctx.beginPath(),this.isInverted?(this.ctx.arc(t+s,i+s,s-this.knobBuffer,n,c,!0),this.ctx.arc(t+s,i+s,.3*(s-this.knobBuffer),c,n,!1)):(this.ctx.arc(t+s,i+s,s-this.knobBuffer,h,c,!1),this.ctx.arc(t+s,i+s,.3*(s-this.knobBuffer),c,h,!0)),this.ctx.closePath(),this.ctx.fill()}this.ctx.beginPath(),this.ctx.arc(t+s,i+s,s-this.knobBuffer,h,n,!1),this.ctx.arc(t+s,i+s,.3*(s-this.knobBuffer),n,h,!0),this.ctx.closePath(),this.ctx.stroke(),null!==this.label&&(this.ctx.fillStyle=this._stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.font=this._font(),this.ctx.fillText(this.label,t+s,i+2.25*s))},setValue:function(t,i){var e=this.max-this.min,s=t;this.lastValue=this.value,this.value=t,0!==this.min||1!==this.max?(s-=this.min,this._value=s/e):this._value=this.value,this.value!==this.lastValue&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.refresh(),this.lastValue=this.value),i||this.refresh()},changeValue:function(t,i){if(this.hasFocus||!this.requiresFocus){var e=this._width()/2;if(this.lastValue=this.value,this.usesRotation){var s=e-t,h=e-i,n=Math.PI+Math.atan2(h,s);this._value=(n+1.5*Math.PI)%(2*Math.PI)/(2*Math.PI),this.lastRotationValue>.8&&this._value<.2?this._value=1:this.lastRotationValue<.2&&this._value>.8&&(this._value=0)}else-1!=this.lastPosition&&(this._value-=(i-this.lastPosition)/(2*e));this._value>1&&(this._value=1),this._value<0&&(this._value=0),this.lastRotationValue=this._value,this.lastPosition=i;var a=this.max-this.min;this.value=this.min+this._value*a,this.value!==this.lastValue&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange(),this.refresh(),this.lastValue=this.value)}},hitTest:function(t){return t.x>=this._x()&&t.x<this._x()+this._width()&&t.y>=this._y()&&t.y<this._y()+this._width()?!0:!1},mousedown:function(t){this.lastPosition=t.y-this._y(),this.changeValue(t.x-this._x(),t.y-this._y())},mousemove:function(t){this.changeValue(t.x-this._x(),t.y-this._y())},mouseup:function(){},touchstart:function(t){this.lastPosition=t.y-this._y(),this.changeValue(t.x-this._x(),t.y-this._y())},touchmove:function(t){this.changeValue(t.x-this._x(),t.y-this._y())},touchend:function(){},_init:function(){var t=this.width,i=this.height;Object.defineProperty(this,"width",{configurable:!0,get:function(){return t},set:function(e){this.clear(),t=i=e,this.refresh()}}),Object.defineProperty(this,"height",{configurable:!0,get:function(){return i},set:function(t){i=t}})}}).init(arguments[0])},Interface.Knob.prototype=Interface.Widget,Interface.XY=function(){var t=this,i={x:0,y:0},e={x:0,y:0},s={x:0,y:0},h=0;Interface.extend(this,{type:"XY",_value:0,serializeMe:["childWidth","childHeight","numChildren","usePhysics","values","friction","maxVelocity","detectCollisions","fps"],childWidth:25,childHeight:25,children:[],values:[],_values:[],numChildren:1,usePhysics:!0,friction:.9,activeTouch:null,maxVelocity:10,detectCollisions:!0,touchCount:0,timer:null,fps:30,rainbow:function(){for(var t=0;t<this.children.length;t++){var i=this.children[t];i.fill=Interface.XY.colors[t%Interface.XY.colors.length]}},remove:function(){this.stopAnimation()},add:function(){this.usePhysics&&this.startAnimation()},startAnimation:function(){null===this.timer&&(this.timer=setInterval(function(){t.refresh()},1/this.fps*1e3))},stopAnimation:function(){clearInterval(this.timer),this.timer=null},animate:function(){for(var t=(this._x(),this._y(),this._width()),i=this._height(),e=!1,s=0;s<this.children.length;s++){var h=(moveY=!1,this.children[s]);h.x+h.vx<t&&h.x+h.vx>0?h.x+=h.vx:h.x+h.vx>=t&&h.vx>0?h.vx*=-1:h.x+h.vx<=0&&h.vx<0?h.vx*=-1:h.x+=h.vx,h.y+h.vy<i&&h.y+h.vy>0?h.y+=h.vy:h.y+h.vy>=i&&h.vy>0?h.vy*=-1:h.y+h.vy<=0&&h.vy<0?h.vy*=-1:h.y+=h.vy,h.vx*=this.friction,h.vy*=this.friction;var n=h.x/t,a=h.y/i,o=this.max-this.min;(this.values[h.id].x!==n||this.values[h.id].y!==a)&&(this.values[h.id].x=this.min+o*n,this.values[h.id].y=this.min+o*a,e=!0),this.detectCollisions&&(h.collideFlag?h.collideFlag=!1:this.collisionTest(h)),h.vx=Math.abs(h.vx)>this.maxVelocity?this.maxVelocity*sign(h.vx):h.vx,h.vy=Math.abs(h.vy)>this.maxVelocity?this.maxVelocity*sign(h.vy):h.vy}e&&(this.sendTargetMessage(),this.onvaluechange&&this.onvaluechange())},sendValues:function(){var t="";this._values.length=0;for(var i=0;i<this.values.length;i++)t+=ss,this._values.push(this.values[i].x),this._values.push(this.values[i].y);Interface.OSC.send(this.key,t,this._values)},collisionTest:function(t){for(var i=2*this.childWidth*2*this.childWidth,e=0;e<this.children.length;e++){var s=this.children[e];if(t.id!==s.id){var h=Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2);i>h&&this.collide(t,s)}}},collide:function(t,n){i.x=t.x-n.x,i.y=t.y-n.y,e.x=t.vx-n.vx,e.y=t.vy-n.vy,h=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)),s.x=i.x/h,s.y=i.y/h;var a=s.x*e.x+s.y*e.y;n.vx=t.vx+a*s.x,n.vy=t.vy+a*s.y,t.vx=n.vx-a*s.x,t.vy=n.vy-a*s.y,n.x-=s.x,n.y-=s.y,t.x+=s.x,t.y+=s.y,t.vx=Math.abs(t.vx)>this.maxVelocity?this.maxVelocity*sign(t.vx):t.vx,t.vy=Math.abs(t.vy)>this.maxVelocity?this.maxVelocity*sign(t.vy):t.vy,n.vx=Math.abs(n.vx)>this.maxVelocity?this.maxVelocity*sign(n.vx):n.vx,n.vy=Math.abs(n.vy)>this.maxVelocity?this.maxVelocity*sign(n.vy):n.vy,t.collideFlag=!0,n.collideFlag=!0},draw:function(){var t=this._x(),i=this._y(),e=this._width(),s=this._height();this.usePhysics&&this.animate(),this.ctx.fillStyle=this._background(),this.ctx.strokeStyle=this._stroke(),this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(t+e,i),this.ctx.lineTo(t+e,i+s),this.ctx.lineTo(t,i+s),this.ctx.lineTo(t,i),this.ctx.fill(),this.ctx.stroke(),this.ctx.clip(),this.ctx.fillStyle=this._fill();for(var h=0;h<this.children.length;h++){var n=this.children[h];this.ctx.fillStyle=n.fill||this._fill(),this.ctx.beginPath(),this.ctx.arc(t+n.x,i+n.y,this.childWidth,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.fillStyle=this._stroke(),this.ctx.fillText(n.id,t+n.x,i+n.y)}this.ctx.closePath(),this.ctx.restore()},changeValue:function(t,i,e){(this.hasFocus||!this.requiresFocus)&&(t.x=i,t.x<0&&(t.x=0),t.x>this._width()&&(t.x=this._width()),t.y=e,t.y<0&&(t.y=0),t.y>this._height()&&(t.y=this._height()),this.values[t.id].x=i/this._width(),this.values[t.id].y=e/this._height(),this.onvaluechange&&this.onvaluechange(),this.usePhysics||this.refresh())},makeChildren:function(){for(var t=0;t<this.numChildren;t++)this.children.push({id:t,x:Math.random()*this._width(),y:Math.random()*this._height(),vx:0,vy:0,collideFlag:!1,isActive:!1,lastPosition:null}),this.values.push({x:null,y:null})},touchEvent:function(t){var i=this.hitTest(t),e=convertTouchEvent(t.type);i?("touchstart"===t.type?(this.hasFocus=!0,this.touchCount++,this.trackTouch(t.x-this._x(),t.y-this._y(),t)):this[t.type]&&this[t.type](t,i,t.childID),this["on"+t.type]&&this["on"+t.type](t,i,t.childId),this["on"+e]&&this["on"+e](t,i)):"touchend"===t.type&&(this.touchCount--,0===this.touchCount?this.hasFocus=!1:this.touchCount<0&&(this.touchCount=0),this.touchend(t),this["on"+t.type]&&this["on"+t.type](t,i,t.childId),this["on"+e]&&this["on"+e](t,i))},trackMouse:function(t,i){for(var e=1e4,s=null,h=null,n=0;n<this.children.length;n++){var a=this.children[n],o=Math.abs(a.x-t),c=Math.abs(a.y-i);e>o+c&&(e=o+c,s=a,h=n)}s.isActive=!0,s.vx=0,s.vy=0,null!=s&&this.changeValue(s,t,i),this.activeTouch=s,this.activeTouch.lastTouch=null,this.lastTouched=s},mousedown:function(t){this.hitTest(t)&&this.trackMouse(t.x-this._x(),t.y-this._y())},mousemove:function(t){if(this.hitTest(t)&&null!==this.activeTouch){if(null===this.activeTouch.lastTouch)this.activeTouch.lastTouch={x:t.x-this._x(),y:t.y-this._y()};else{var i={x:t.x-this._x(),y:t.y-this._y()};this.activeTouch.velocity={x:i.x-this.activeTouch.lastTouch.x,y:i.y-this.activeTouch.lastTouch.y},this.activeTouch.lastTouch=i}this.changeValue(this.activeTouch,t.x-this._x(),t.y-this._y())}},mouseup:function(){null!==this.activeTouch&&(this.activeTouch.vx=this.activeTouch.velocity.x,this.activeTouch.vy=this.activeTouch.velocity.y,this.activeTouch.lastTouch=null,this.activeTouch=null);for(var t=0;t<this.children.length;t++)this.children[t].isActive=!1},trackTouch:function(t,i,e){for(var s=1e4,h=null,n=null,a=0;a<this.children.length;a++){var o=this.children[a],c=Math.abs(o.x-t),l=Math.abs(o.y-i);s>c+l&&!o.isActive&&(s=c+l,h=o,n=a)}return h.isActive=!0,h.vx=0,h.vy=0,h.identifier=e.identifier,h.childID=n,null!=h&&this.changeValue(h,t,i),this.lastTouched=h,h.childID},touchstart:function(){},touchmove:function(t){for(var i=0;i<this.children.length;i++)if(_t=this.children[i],t.identifier==_t.identifier){this.changeValue(_t,t.x-this._x(),t.y-this._y());var e={x:t.x-this._x(),y:t.y-this._y()};null!==_t.lastPosition&&(_t.velocity={x:e.x-_t.lastPosition.x,y:e.y-_t.lastPosition.y}),_t.lastPosition=e}},touchend:function(t){for(var i=!1,e=null,s=0;s<this.children.length;s++){var h=this.children[s];t.identifier===h.identifier&&(h.vx=h.velocity.x,h.vy=h.velocity.y,h.lastPosition=null,h.isActive=!1,i=!0,e=s.childID)}i&&(this.touchUp=e)},_init:function(){this.makeChildren()}}).init(arguments[0]),this.requiresFocus=!1,this.half=this.childWidth/2;var n=this.numChildren;Object.defineProperty(this,"numChildren",{get:function(){return n},set:function(t){for(;t>n;)this.children.push({id:this.children.length,x:Math.random()*this._width(),y:Math.random()*this._height(),vx:0,vy:0,collideFlag:!1,isActive:!1,lastPosition:null}),this.values.push({x:null,y:null}),n++;for(;n>t;)this.chidren.pop(),this.values.pop(),n--;this.refresh(),n=t}})},Interface.XY.prototype=Interface.Widget,Interface.XY.colors=["rgba(255,0,0,.35)","rgba(0,255,0,.35)","rgba(0,0,255,.35)","rgba(0,255,255,.35)","rgba(255,0,255,.35)","rgba(255,255,0,.35)"],Interface.Menu=function(){Interface.extend(this,{type:"Menu",_value:0,serializeMe:["options","fontSize"],options:[],fontSize:15,touchEvent:function(t){this.hitTest(t)&&t.stopPropagation()},_init:function(){this.element=$("<select>");for(var t=0;t<this.options.length;t++){var i=$("<option>"+this.options[t]+"</option>");this.element.append(i)}this.element.css({position:"absolute",backgroundColor:this._background(),color:this._stroke(),left:this._x()+this.panel.x,top:this._y()+this.panel.y,width:this._width(),height:this._height(),fontSize:this.fontSize,display:"block",border:"1px solid "+this._stroke()}),this.css&&this.element.css(this.css);var e=this;this.element.change(function(){var t=e.value;e.value=e.element.val(),e.sendTargetMessage(),e.onvaluechange(e.value,t)}),-1!==this.options.indexOf(this.value)?this.element.val(this.value):this.element.val(this.options[0]),$(this.container).append(this.element)}}).init(arguments[0])},Interface.Menu.prototype=Interface.Widget,Interface.Label=function(){Interface.extend(this,{type:"Label",serializeMe:["size","style","hAlign","vAlign","font"],size:12,style:"normal",hAlign:"center",vAlign:"top",font:"sans-serif",draw:function(){this.ctx.font=this.style+" "+this.size+"px "+this.font,this.ctx.textAlign=this.hAlign,this.ctx.textBaseline=this.vAlign;var t,i,e=this.ctx.measureText(this.lastValue),s={x:0,y:this._y()-this.size/2,width:e.width,height:this.size};switch(this.hAlign){case"center":t=this._x()+this._width()/2,s.x=t-e.width/2;break;case"left":t=this._x(),s.x=t;break;case"right":t=this._x()+this._width(),s.x=t-e.width}switch(this.vAlign){case"middle":i=this._y()+this._height()/2,s.y=i-e.height/2;break;case"top":i=this._y(),s.y=i;break;case"bottom":i=this._y()+this._height(),s.y=i-e.height}this.ctx.clearRect(s.x,s.y,s.width,2*s.height),this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this._x(),this._y()),this.ctx.lineTo(this._x()+this._width(),this._y()),this.ctx.lineTo(this._x()+this._width(),this._y()+this._height()),this.ctx.lineTo(this._x(),this._y()+this._height()),this.ctx.lineTo(this._x(),this._y()),this.ctx.closePath(),this.ctx.clip(),this.ctx.fillStyle=this._stroke(),this.ctx.fillText(this.value,t,i),this.ctx.restore(),this.lastValue=this.value}}).init(arguments[0]),this.lastValue=this.value},Interface.Label.prototype=Interface.Widget,Interface.TextField=function(){Interface.extend(this,{type:"TextField",serializeMe:["fontSize"],fontSize:15,touchEvent:function(t){if(this.hitTest(t)){var i=document.createEvent("TouchEvent");i.initUIEvent("touchstart",!0,!0),i.view=window,i.screenX=t.screenX,i.screenY=t.screenY,i.clientX=t.clientX,i.clientY=t.clientY,i.bubbles=!1,i.view=window,i.altKey=!1,i.ctrlKey=!1,i.shiftKey=!1,i.metaKey=!1,this.element.dispatchEvent(i)}},_init:function(){this.element=$("<input>"),0!==this.value&&this.element.val(this.value),this.element.css({position:"absolute",backgroundColor:this._background(),color:this._fill(),left:this._x()+this.panel.x,top:this._y()+this.panel.y,width:this._width(),height:this._height(),fontSize:this.fontSize,display:"block",border:"1px solid "+this._stroke()}),this.css&&this.element.css(this.css);var t=this;this.element.change(function(){var i=t.value;t.value=t.element.val(),t.sendTargetMessage(),t.onvaluechange(t.value,i)}),$(this.container).append(this.element)}}).init(arguments[0])},Interface.TextField.prototype=Interface.Widget,Interface.MultiSlider=function(){Interface.extend(this,{type:"MultiSlider",isVertical:!0,serializeMe:["isVertical","count","values"],values:[],_values:[],count:16,draw:function(){var t=this._x(),i=this._y(),e=this._width(),s=this._height(),h=e/this.count;this.ctx.fillStyle=this._background(),this.ctx.fillRect(t,i,e,s),this.ctx.fillStyle=this._fill(),this.ctx.strokeStyle=this._stroke();for(var n=0;n<this.count;n++){var a=n*h+t;this.ctx.fillRect(a,i+s-this._values[n]*s,h,this._values[n]*s),this.ctx.strokeRect(a,i,h,s)}},changeValue:function(t,i){if(this.hasFocus||!this.requiresFocus){var e=this._width(),s=e/this.count,h=Math.floor(t/s);_value=0,_value=1-i/this._height(),0>_value?_value=0:_value>1&&(_value=1),this.values[h]=this.min+(this.max-this.min)*_value,this._values[h]=_value,"OSC"!==this.target?this.sendTargetMessage():Interface.OSC&&Interface.OSC.send(this.key,"if",[h,this.values[h]]),this.onvaluechange&&this.onvaluechange(h,this.values[h]),this.refresh()}},mousedown:function(t,i){i&&Interface.mouseDown&&this.changeValue(t.x-this._x(),t.y-this._y())},mousemove:function(t,i){i&&Interface.mouseDown&&this.changeValue(t.x-this._x(),t.y-this._y())},mouseup:function(t,i){i&&Interface.mouseDown&&this.changeValue(t.x-this._x(),t.y-this._y())},touchstart:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())},touchmove:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())},touchend:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())},onvaluechange:function(){}}).init(arguments[0]);var t=this.x,i=this.y,e=this.width,s=this.height,h=[t,i,e,s],n=this.count;delete this.bounds,Object.defineProperties(this,{x:{get:function(){return t},set:function(i){t=i,this.refresh()}},y:{get:function(){return i},set:function(t){i=t,this.refresh()}},width:{get:function(){return e},set:function(t){e=t,this.refresh()}},height:{get:function(){return s},set:function(t){s=t,this.refresh()}},bounds:{get:function(){return h},set:function(n){h=n,t=h[0],i=h[1],e=h[2],s=h[3],this.refresh()}},count:{get:function(){return n
},set:function(t){n=t,this.refresh()}}})},Interface.MultiSlider.prototype=Interface.Widget,Interface.MultiButton=function(){Interface.extend(this,{type:"MultiButton",mode:"toggle",serializeMe:["mode","rows","columns","requiresFocus"],rows:8,values:[],_values:[],lastValues:[],mouseOver:null,columns:8,draw:function(){var t=this._x(),i=this._y(),e=this._width(),s=this._height(),h=e/this.columns,n=s/this.rows;this.ctx.strokeStyle=this._stroke();for(var a=0;a<this.rows;a++)for(var o=0;o<this.columns;o++){var c=t+o*h,l=i+a*n,u=a*this.columns+o;this.ctx.fillStyle=this._values[u]?this._fill():this._background(),this.ctx.fillRect(c,l,h,n),this.ctx.strokeRect(c,l,h,n)}},changeValue:function(t,i){if(this.hasFocus||!this.requiresFocus){var e=this._width(),s=this._height(),h=e/this.columns,n=Math.floor(t/h),a=s/this.rows,o=Math.floor(i/a),c=o*this.columns+n;if(c!==this.mouseOver){if(this._values[c]=!this._values[c],this.values[c]=this._values[c]?this.max:this.min,(this.values[c]!==this.lastValues[c]||"contact"===this.mode)&&("OSC"!==this.target?this.sendTargetMessage():Interface.OSC&&Interface.OSC.send(this.key,"iif",[o,n,this.values[c]]),this.onvaluechange&&this.onvaluechange(o,n,this.values[c]),this.draw(),this.lastValues[c]=this.values[c],"contact"===this.mode)){var l=this;setTimeout(function(){l._values[c]=0,l.draw()},75)}this.mouseOver=c}}},mousedown:function(t,i){i&&Interface.mouseDown&&this.changeValue(t.x-this._x(),t.y-this._y())},mousemove:function(t,i){i&&Interface.mouseDown&&this.changeValue(t.x-this._x(),t.y-this._y())},mouseup:function(t,i){i&&Interface.mouseDown&&this.changeValue(t.x-this._x(),t.y-this._y()),this.mouseOver=null},touchstart:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())},touchmove:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())},touchend:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())}}).init(arguments[0]),this.requiresFocus=!1;var t=this.x,i=this.y,e=this.width,s=this.height,h=[t,i,e,s];rows=this.rows,columns=this.columns,delete this.bounds,Object.defineProperties(this,{x:{get:function(){return t},set:function(i){t=i,this.refresh()}},y:{get:function(){return i},set:function(t){i=t,this.refresh()}},width:{get:function(){return e},set:function(t){e=t,this.refresh()}},height:{get:function(){return s},set:function(t){s=t,this.refresh()}},bounds:{get:function(){return h},set:function(n){h=n,t=h[0],i=h[1],e=h[2],s=h[3],this.refresh()}},rows:{get:function(){return rows},set:function(t){rows=t,this.refresh()}},columns:{get:function(){return columns},set:function(t){columns=t,this.refresh()}}})},Interface.MultiButton.prototype=Interface.Widget,Interface.Accelerometer=function(){var t=this,i=9.80665;Interface.extend(this,{type:"Accelerometer",serializeMe:["delay"],delay:100,min:0,max:1,values:[0,0,0],update:function(i){var e=i.acceleration;t.x=t.values[0]=t.min+(0-t.hardwareMin+e.x)/t.hardwareRange*t.max,t.y=t.values[1]=t.min+(0-t.hardwareMin+e.y)/t.hardwareRange*t.max,t.z=t.values[2]=t.min+(0-t.hardwareMin+e.z)/t.hardwareRange*t.max,"undefined"!=typeof t.onvaluechange&&t.onvaluechange(t.x,t.y,t.z),t.sendTargetMessage()},start:function(){return window.addEventListener("devicemotion",this.update,!0),this},stop:function(){return window.removeEventListener("devicemotion",this.update),this}}).init(arguments[0]),Interface.isAndroid?(this.hardwareMin=i,this.hardwareMax=i):(this.hardwareMin=-2.307*i,this.hardwareMax=2.307*i),this.hardwareRange=this.hardwareMax-this.hardwareMin},Interface.Accelerometer.prototype=Interface.Widget,Interface.Orientation=function(){var t=this;Interface.extend(this,{type:"Orientation",serializeMe:["delay"],delay:100,values:[0,0,0],update:function(i){t.roll=t.values[0]=t.min+(90+i.gamma)/180*t.max,t.pitch=t.values[1]=t.min+(180+i.beta)/360*t.max,t.yaw=t.values[2]=t.min+i.alpha/360*t.max,isNaN(i.webkitCompassHeading)||(t.heading=t.min+i.webkitCompassHeading/360*t.max),t.sendTargetMessage(),"undefined"!=typeof t.onvaluechange&&t.onvaluechange(t.pitch,t.roll,t.yaw,t.heading)},start:function(){return window.addEventListener("deviceorientation",function(i){t.update(i)},!0),this},stop:function(){window.removeEventListener("deviceorientation")}}).init(arguments[0])},Interface.Orientation.prototype=Interface.Widget,Interface.Range=function(){Interface.extend(this,{type:"Range",serializeMe:["handleSize"],handleSize:20,values:[0,1],_values:[0,1],draw:function(){var t=this._x(),i=this._y(),e=this._width(),s=this._height();this.ctx.fillStyle=this._background(),this.ctx.clearRect(t,i,e,s);var h=t+this._values[1]*e-this.handleSize,n=t+this._values[0]*e;this.ctx.fillStyle=this._background(),this.ctx.fillRect(t,i,e,s),this.ctx.fillStyle=this._fill(),this.ctx.fillRect(n,i,h-n,s),this.ctx.fillStyle=this._stroke(),this.ctx.fillRect(n,i,this.handleSize,s),this.ctx.fillRect(h,i,this.handleSize,s),this.ctx.strokeStyle=this._stroke(),this.ctx.strokeRect(t,i,e,s)},changeValue:function(t,i){if(this.hasFocus||!this.requiresFocus){var e=this.isVertical?1-i/this._height():t/this._width();0>e?e=0:e>1&&(e=1);var s=this.max-this.min;Math.abs(e-this._values[0])<Math.abs(e-this._values[1])?(this._values[0]=e,this.values[0]=this.min+s*e):(this._values[1]=e,this.values[1]=this.min+s*e),this.refresh(),(this.values[0]!==this.lastLeftValue||this.values[1]!==this.lastRightValue)&&(this.onvaluechange&&this.onvaluechange(this.values[0],this.values[1]),this.refresh(),this.lastLeftValue=this.values[0],this.lastRightValue=this.values[1],this.sendTargetMessage())}},mousedown:function(t,i){i&&Interface.mouseDown&&this.changeValue(t.x-this._x(),t.y-this._y())},mousemove:function(t,i){i&&Interface.mouseDown&&this.changeValue(t.x-this._x(),t.y-this._y())},mouseup:function(t,i){i&&Interface.mouseDown&&this.changeValue(t.x-this._x(),t.y-this._y())},touchstart:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())},touchmove:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())},touchend:function(t,i){i&&this.changeValue(t.x-this._x(),t.y-this._y())}}).init(arguments[0])},Interface.Range.prototype=Interface.Widget,Interface.defineChildProperties=function(t,i){for(var e=0;e<i.length;e++)!function(){var s=i[e],h=t[s];Object.defineProperty(t,s,{get:function(){return h},set:function(i){h=i;for(var e=0;e<t.children.length;e++)t.children[e][s]=h}})}()};